<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trkey Keymap Configurator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for the shortcut pool */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="bg-zinc-800 text-white">
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <script type="text/babel">
        // React and ReactDOM are now globally available from the CDN scripts loaded above.
        const { useState, useEffect, useCallback, useRef } = React;
        // ReactDOM is also globally available as ReactDOM

        // This array defines all common keyboard buttons as shortcut options for the Trkey Keymap Configurator.
        // Each object contains:
        // - name: A human-readable label for the button.
        // - combo: The string representation that matches the firmware's sendCombo function.
        // This list is comprehensive and covers alphanumeric, symbol, function, navigation, modifier, numpad, and media keys.
        const allKeyboardButtons = [
            // --- Alphanumeric & Basic Punctuation ---
            { name: 'A', combo: 'A' }, { name: 'B', combo: 'B' }, { name: 'C', combo: 'C' },
            { name: 'D', combo: 'D' }, { name: 'E', combo: 'E' }, { name: 'F', combo: 'F' },
            { name: 'G', combo: 'G' }, { name: 'H', combo: 'H' }, { name: 'I', combo: 'I' },
            { name: 'J', combo: 'J' }, { name: 'K', combo: 'K' }, { name: 'L', combo: 'L' },
            { name: 'M', combo: 'M' }, { name: 'N', combo: 'N' }, { name: 'O', combo: 'O' },
            { name: 'P', combo: 'P' }, { name: 'Q', combo: 'Q' }, { name: 'R', combo: 'R' },
            { name: 'S', combo: 'S' }, { name: 'T', combo: 'T' }, { name: 'U', combo: 'U' },
            { name: 'V', combo: 'V' }, { name: 'W', combo: 'W' }, { name: 'X', combo: 'X' },
            { name: 'Y', combo: 'Y' }, { name: 'Z', combo: 'Z' },

            { name: '0', combo: '0' }, { name: '1', combo: '1' }, { name: '2', combo: '2' },
            { name: '3', combo: '3' }, { name: '4', combo: '4' }, { name: '5', combo: '5' },
            { name: '6', combo: '6' }, { name: '7', combo: '7' }, { name: '8', combo: '8' },
            { name: '9', combo: '9' },

            { name: 'Space', combo: 'SPACE' },
            { name: '-', combo: '-' }, { name: '=', combo: '=' },
            { name: '[', combo: '[' }, { name: ']', combo: ']' },
            { name: '\\', combo: '\\' }, { name: ';', combo: ';' },
            { name: '\'', combo: '\'' }, { name: ',', combo: ',' },
            { name: '.', combo: '.' }, { name: '/', combo: '/' },
            { name: '`', combo: '`' }, // Tilde/backtick key

            // --- Modifiers & Special Keys ---
            { name: 'Enter', combo: 'ENTER' },
            { name: 'Tab', combo: 'TAB' },
            { name: 'Esc', combo: 'ESC' },
            { name: 'Backspace', combo: 'BACKSPACE' },
            { name: 'Caps Lock', combo: 'CAPSLOCK' },
            { name: 'Print Screen', combo: 'PRINTSCREEN' },
            { name: 'Scroll Lock', combo: 'SCROLLLOCK' },
            { name: 'Pause', combo: 'PAUSE' },
            { name: 'Left Ctrl', combo: 'LCTRL' }, { name: 'Right Ctrl', combo: 'RCTRL' },
            { name: 'Left Shift', combo: 'LSHIFT' }, { name: 'Right Shift', combo: 'RSHIFT' },
            { name: 'Left Alt', combo: 'LALT' }, { name: 'Right Alt', combo: 'RALT' },
            { name: 'Left GUI/Win/Cmd', combo: 'LGUI' }, { name: 'Right GUI/Win/Cmd', combo: 'RGUI' },
            { name: 'Application', combo: 'APPLICATION' }, // Context Menu key
            { name: 'Power', combo: 'POWER' },

            // --- Navigation Keys ---
            { name: 'Up Arrow', combo: 'UP' },
            { name: 'Down Arrow', combo: 'DOWN' },
            { name: 'Left Arrow', combo: 'LEFT' },
            { name: 'Right Arrow', combo: 'RIGHT' },
            { name: 'Home', combo: 'HOME' },
            { name: 'End', combo: 'END' },
            { name: 'Page Up', combo: 'PAGEUP' },
            { name: 'Page Down', combo: 'PAGEDOWN' },
            { name: 'Insert', combo: 'INSERT' },
            { name: 'Delete', combo: 'DELETE' },

            // --- Function Keys ---
            { name: 'F1', combo: 'F1' }, { name: 'F2', combo: 'F2' }, { name: 'F3', combo: 'F3' },
            { name: 'F4', combo: 'F4' }, { name: 'F5', combo: 'F5' }, { name: 'F6', combo: 'F6' },
            { name: 'F7', combo: 'F7' }, { name: 'F8', combo: 'F8' }, { name: 'F9', combo: 'F9' },
            { name: 'F10', combo: 'F10' }, { name: 'F11', combo: 'F11' }, { name: 'F12', combo: 'F12' },
            { name: 'F13', combo: 'F13' }, { name: 'F14', combo: 'F14' }, { name: 'F15', combo: 'F15' },
            { name: 'F16', combo: 'F16' }, { name: 'F17', combo: 'F17' }, { name: 'F18', combo: 'F18' },
            { name: 'F19', combo: 'F19' }, { name: 'F20', combo: 'F20' }, { name: 'F21', combo: 'F21' },
            { name: 'F22', combo: 'F22' }, { name: 'F23', combo: 'F23' }, { name: 'F24', combo: 'F24' },

            // --- Numpad Keys ---
            { name: 'Num Lock', combo: 'NUMLOCK' },
            { name: 'KP /', combo: 'KPSLASH' },
            { name: 'KP *', combo: 'KPASTERISK' },
            { name: 'KP -', combo: 'KPMINUS' },
            { name: 'KP +', combo: 'KPPLUS' },
            { name: 'KP Enter', combo: 'KPENTER' },
            { name: 'KP 1', combo: 'KP1' }, { name: 'KP 2', combo: 'KP2' }, { name: 'KP 3', combo: 'KP3' },
            { name: 'KP 4', combo: 'KP4' }, { name: 'KP 5', combo: 'KP5' }, { name: 'KP 6', combo: 'KP6' },
            { name: 'KP 7', combo: 'KP7' }, { name: 'KP 8', combo: 'KP8' }, { name: 'KP 9', combo: 'KP9' },
            { name: 'KP 0', combo: 'KP0' },
            { name: 'KP .', combo: 'KPDOT' },
            { name: 'KP =', combo: 'KPEQUAL' },

            // --- Media Keys ---
            { name: 'Mute', combo: 'MUTE' },
            { name: 'Volume Up', combo: 'VOLUP' },
            { name: 'Volume Down', combo: 'VOLDOWN' },
            { name: 'Play/Pause', combo: 'PLAYPAUSE' },
            { name: 'Next Track', combo: 'NEXTTRACK' },
            { name: 'Previous Track', combo: 'PREVTRACK' },
            { name: 'Brightness Up', combo: 'BRIGHTNESSUP' },
            { name: 'Brightness Down', combo: 'BRIGHTNESSDOWN' },

            // --- Non-US Specific Keys (common on some layouts) ---
            { name: 'Non-US Hash', combo: 'NONUSHASH' },
            { name: 'Non-US Backslash', combo: 'NONUSBACKSLASH' },

            // --- Layer Switching (Example) ---
            { name: 'Layer 0', combo: 'LAYER+0' },
            { name: 'Layer 1', combo: 'LAYER+1' },
            { name: 'Layer 2', combo: 'LAYER+2' },
            { name: 'Layer 3', combo: 'LAYER+3' },
            { name: 'Layer 4', combo: 'LAYER+4' },
        ];


        // --- START OF PRESETS DATA ---
        const presets = {
            "BASIC": [
                { combo: "M", description: "Move" },
                { combo: "V", description: "Via" },
                { combo: "R", description: "Rotate" },
                { combo: "Del", description: "Delete" },
                { combo: "Ctrl+Z", description: "Undo" },
                { combo: "Ctrl+Y", "description": "Redo" },
                { combo: "F1", description: "Help" },
                { combo: "F2", description: "Rename" },
                { combo: "F3", description: "Search" },
                { combo: "L", description: "Line" },
                { combo: "E", description: "Extrude" },
                { combo: "P", description: "Project" },
                { combo: "C", description: "Circle" },
                { combo: "Q", description: "Press/Pull" },
                { combo: "X", description: "Cut" },
                { combo: "S", description: "Sketch" },
                { combo: "T", description: "Text" },
                { combo: "Ctrl+C", description: "Copy" },
                { combo: "Ctrl+V", description: "Paste" },
                { combo: "Ctrl+Z", description: "Undo" },
                { combo: "Ctrl+X", description: "Cut" },
                { combo: "Ctrl+S", description: "Save" },
                { combo: "Ctrl+Shift+G", description: "Ungroup" },
                { combo: "Alt+Shift+B", description: "Bring to Back" },
                { combo: "Ctrl+D", description: "Duplicate" },
                { combo: "Ctrl+Alt+K", description: "Lock" },
                { combo: "Ctrl+P", description: "Command Palette" },
                { combo: "Ctrl+Shift+P", description: "Show All Commands" },
                { combo: "Ctrl+F", description: "Find" },
                { combo: "Alt+Shift+F", description: "Format Document" },
            ],
            "STANDARD_KEYS": allKeyboardButtons, // Add all keyboard buttons as a new preset category
            "WINDOWS_SHORTCUTS": [
                { combo: "Win+D", description: "Show Desktop" },
                { combo: "Win+E", description: "Open File Explorer" },
                { combo: "Win+L", description: "Lock Screen" },
                { combo: "Win+Tab", description: "Task View" },
                { combo: "Alt+F4", description: "Close App/Shutdown" },
                { combo: "Ctrl+Shift+Esc", description: "Open Task Manager" },
                { combo: "Win+PrintScreen", description: "Screenshot to File" },
                { combo: "Win+.", description: "Emoji Panel" },
                { combo: "Win+Shift+S", description: "Snip & Sketch" },
            ],
            "MACOS_SHORTCUTS": [
                { combo: "Cmd+Space", description: "Spotlight Search" },
                { combo: "Cmd+C", description: "Copy" },
                { combo: "Cmd+V", description: "Paste" },
                { combo: "Cmd+Z", description: "Undo" },
                { combo: "Cmd+X", description: "Cut" },
                { combo: "Cmd+S", description: "Save" },
                { combo: "Cmd+Q", description: "Quit App" },
                { combo: "Cmd+W", description: "Close Window" },
                { combo: "Cmd+Tab", description: "Switch Apps" },
                { combo: "Cmd+Shift+3", description: "Screenshot Full" },
                { combo: "Cmd+Shift+4", description: "Screenshot Selection" },
            ],
            "LINUX_SHORTCUTS": [
                { combo: "Ctrl+Alt+T", description: "Open Terminal" },
                { combo: "Alt+Tab", description: "Switch Windows" },
                { combo: "Ctrl+Alt+Del", description: "Logout/Shutdown Menu" },
                { combo: "Super+D", description: "Show Desktop" }, // 'Super' typically is the Windows/Meta key
                { combo: "Super+L", description: "Lock Screen" },
                { combo: "Ctrl+Shift+N", description: "New Folder" },
                { combo: "F2", description: "Rename File" },
                { combo: "PrintScreen", description: "Screenshot" },
                { combo: "ls", description: "List directory contents" },
                { combo: "cd", description: "Change directory" },
                { combo: "pwd", description: "Print working directory" },
                { combo: "mkdir", description: "Make directory" },
                { combo: "rm", description: "Remove file/directory" },
                { combo: "cp", description: "Copy file" },
                { combo: "mv", description: "Move file" },
                { combo: "sudo", description: "Run command as superuser" },
                { combo: "man", description: "Manual pages" },
                { combo: "top", description: "Show running processes" },
                { combo: "ps", description: "List processes" },
                { combo: "kill", description: "Terminate process" },
                { combo: "grep", description: "Search text" },
                { combo: "chmod", description: "Change permissions" },
                { combo: "chown", description: "Change ownership" },
                { combo: "nano", description: "Text editor" },
                { combo: "vim", description: "Vi Improved editor" },
                { combo: "df", description: "Disk usage" },
                { combo: "du", description: "Directory usage" },
                { combo: "tar", description: "Archive files" },
                { combo: "zip/unzip", description: "Compress/Extract" },
                { combo: "ssh", description: "Remote access" },
                { combo: "scp", description: "Secure copy" },
                { combo: "wget", description: "Download files" },
                { combo: "curl", description: "Transfer data" },
                { combo: "alias", description: "Create shortcut command" },
                { combo: "history", description: "Show command history" },
                { combo: "clear", description: "Clear terminal" },
                { combo: "reboot", description: "Restart system" },
                { combo: "shutdown", description: "Shutdown system" },
                { combo: "uptime", description: "Show system uptime" },
            ],
            "ANDROID_SHORTCUTS": [
                { combo: "RecentApps", description: "Show Recent Apps" },
                { combo: "Home", description: "Go Home" },
                { combo: "Back", description: "Go Back" },
                { combo: "VolumeUp", description: "Volume Up" },
                { combo: "VolumeDown", description: "Volume Down" },
                { combo: "Power", description: "Power Button" },
                { combo: "Search", description: "Open Search" },
                { combo: "Camera", description: "Open Camera" },
            ],
            "IPAD_SHORTCUTS": [
                { combo: "Cmd+Space", description: "Search/Spotlight" },
                { combo: "Cmd+H", description: "Go Home" },
                { combo: "Cmd+Tab", description: "Switch Apps" },
                { combo: "Cmd+Shift+3", description: "Screenshot Full" },
                { combo: "Cmd+Shift+4", description: "Screenshot Selection" },
                { combo: "Globe+C", description: "Copy (Contextual)" }, // Globe key is common on iPad keyboards
                { combo: "Globe+V", description: "Paste (Contextual)" },
                { combo: "Globe+Z", description: "Undo (Contextual)" },
            ],
            "MINECRAFT_SHORTCUTS": [
                { combo: "W", description: "Move forward" },
                { combo: "A", description: "Move left" },
                { combo: "S", description: "Move backward" },
                { combo: "D", description: "Move right" },
                { combo: "Space", description: "Jump" },
                { combo: "Shift", description: "Sneak" },
                { combo: "Ctrl", description: "Sprint" },
                { combo: "E", description: "Open inventory" },
                { combo: "Q", description: "Drop selected item" },
                { combo: "T", description: "Open chat" },
                { combo: "F3+D", description: "Clear chat" },
                { combo: "F5", description: "Change camera" },
                { combo: "F8", description: "Smooth camera" },
                { combo: "Tab", description: "Player list" },
                { combo: "Esc", description: "Menu" },
                { combo: "Middle Click", description: "Pick block (Creative)" },
                { combo: "Double Space", description: "Fly toggle (Creative)" },
                { combo: "Ctrl+Middle Click", description: "Copy block with NBT" },
                { combo: "Shift+Left Click", description: "Destroy instantly (Creative)" },
                { combo: "Shift+Right Click", description: "Edit command block (Creative)" },
                { combo: "Shift+Click", description: "Move stack (Inventory)" },
                { combo: "Ctrl+Q", description: "Drop stack" },
                { combo: "Ctrl+Click", description: "Select same items" },
                { combo: "Double Click", description: "Grab all of that item" },
                { combo: "Mouse wheel", description: "Scroll hotbar" },
                { combo: "Number+Hover", description: "Move item to hotbar" },
                { combo: "F3+N", description: "Switch gamemode" },
                { combo: "Alt+F4", description: "Rage quit" },
                { combo: "F3+C", description: "Force crash" },
                { combo: "F3+A", description: "Reload chunks" },
                { combo: "Shift+Click", description: "Craft all (in recipe book)" },
            ],
            "WAR_THUNDER_SHORTCUTS": [
                { combo: "W/S", description: "Throttle up/down" },
                { combo: "A/D", description: "Rudder left/right" },
                { combo: "Q/E", description: "Roll left/right" },
                { combo: "Shift", description: "Afterburner" },
                { combo: "Ctrl", description: "Air brake" },
                { combo: "G", description: "Landing gear" },
                { combo: "F", description: "Flaps" },
                { combo: "V", description: "View mode" },
                { combo: "C", description: "Free camera" },
                { combo: "X", description: "Look left" },
                { combo: "Z", description: "Look right" },
                { combo: "Y", description: "Look back" },
                { combo: "B", description: "Bomb view" },
                { combo: "N", description: "Navigation lights" },
                { combo: "J", description: "Bail out" },
                { combo: "M", description: "Map" },
                { combo: "Tab", description: "Scoreboard" },
                { combo: "T", description: "Target" },
                { combo: "R", description: "Radar" },
                { combo: "H", description: "Head tracking" },
                { combo: "Space", description: "Fire main guns" },
                { combo: "Alt", description: "Fire secondary" },
                { combo: "Ctrl+Space", description: "Drop bomb" },
                { combo: "Shift+Space", description: "Fire rocket" },
                { combo: "Mouse 2", description: "Zoom" },
                { combo: "Mouse 1", description: "Fire guns" },
                { combo: "Mouse 3", description: "Track enemy" },
                { combo: "F1", description: "Help" },
                { combo: "F2", description: "Toggle cockpit" },
                { combo: "F3", description: "Chase camera" },
                { combo: "W/A/S/D", description: "Drive (Tank)" },
                { combo: "Shift", description: "Speed boost" },
                { combo: "V", description: "Binocular view" },
                { combo: "U", description: "Repair" },
                { combo: "O", description: "Toggle optics" },
                { combo: "K", description: "Thermal/IR" },
                { combo: "L", description: "Headlights" },
                { combo: "R", description: "Rangefinder" },
                { combo: "C", description: "Commander cam" },
                { combo: "X", description: "Machine gun" },
                { combo: "Esc", description: "Menu" },
                { combo: "Enter", description: "Chat" },
                { combo: "Backspace", description: "Leave vehicle" },
                { combo: "Home", description: "Reset view" },
                { combo: "Del", description: "Zoom out" },
                { combo: "Ins", description: "Zoom in" },
                { combo: "Alt+F10", description: "Save replay" },
                { combo: "Alt+PrintScreen", description: "Screenshot" },
                { combo: "Ctrl+Y", description: "Chat channel" },
                { combo: "Ctrl+G", description: "Gunner view" },
            ],
            "ROBLOX_STUDIO_SHORTCUTS": [
                { combo: "Ctrl+S", description: "Save" },
                { combo: "Ctrl+Shift+S", description: "Save As" },
                { combo: "Ctrl+N", description: "New place" },
                { combo: "Ctrl+O", description: "Open place" },
                { combo: "Ctrl+Z", description: "Undo" },
                { combo: "Ctrl+Y", description: "Redo" },
                { combo: "Ctrl+C/V/X", description: "Copy/Paste/Cut" },
                { combo: "Ctrl+D", description: "Duplicate" },
                { combo: "Ctrl+G", description: "Group" },
                { combo: "Ctrl+U", description: "Ungroup" },
                { combo: "Ctrl+P", description: "Publish" },
                { combo: "F", description: "Focus selection" },
                { combo: "Shift+F", description: "Follow camera" },
                { combo: "Alt+Click", description: "Select parent" },
                { combo: "Ctrl+Click", description: "Multi-select" },
                { combo: "Ctrl+Shift+H", description: "View explorer" },
                { combo: "Ctrl+Shift+X", description: "Properties" },
                { combo: "Ctrl+Shift+C", description: "Output" },
                { combo: "Ctrl+Shift+D", description: "Asset manager" },
                { combo: "Ctrl+Shift+E", description: "Toolbox" },
                { combo: "W/A/S/D", description: "Camera move" },
                { combo: "E/Q", description: "Move up/down" },
                { combo: "T", description: "Rotate" },
                { combo: "R", description: "Resize" },
                { combo: "G", description: "Move" },
                { combo: "Ctrl+T", description: "Anchor" },
                { combo: "Ctrl+L", description: "Lock" },
                { combo: "Ctrl+B", description: "Break joints" },
                { combo: "Ctrl+J", description: "Join surfaces" },
                { combo: "Ctrl+M", description: "Material" },
                { combo: "Ctrl+Shift+M", description: "Model" },
                { combo: "Shift+Drag", description: "Constrain" },
                { combo: "Arrow Keys", description: "Nudge" },
                { combo: "Ctrl+P", description: "Quick publish" },
                { combo: "Alt+Shift+E", description: "Export" },
                { combo: "Ctrl+S", description: "Save" },
            ],
            "ENLISTED_SHORTCUTS": [
                { combo: "W/A/S/D", description: "Move" },
                { combo: "Space", description: "Jump" },
                { combo: "Shift", description: "Sprint" },
                { combo: "Ctrl", description: "Crouch" },
                { combo: "Z", description: "Prone" },
                { combo: "X", description: "Lean left" },
                { combo: "C", description: "Lean right" },
                { combo: "F", description: "Interact" },
                { combo: "R", description: "Reload" },
                { combo: "G", description: "Grenade" },
                { combo: "T", description: "Pick weapon" },
                { combo: "V", description: "Melee" },
                { combo: "B", description: "Fire mode" },
                { combo: "Q/E", description: "Switch soldier" },
                { combo: "Tab", description: "Scoreboard" },
                { combo: "M", description: "Map" },
                { combo: "N", description: "Night vision" },
                { combo: "Y", description: "Orders" },
                { combo: "L", description: "Flashlight" },
                { combo: "Esc", description: "Menu" },
                { combo: "Click", description: "Fire" },
                { combo: "Right Click", description: "Aim" },
                { combo: "Scroll", description: "Change weapon" },
                { combo: "1-3", description: "Weapons" },
                { combo: "H", description: "Help" },
                { combo: "Alt", description: "Free look" },
                { combo: "Ctrl+Shift", description: "Walk" },
                { combo: "F1", description: "Camera" },
                { combo: "Alt+M", description: "Minimap" },
                { combo: "Ctrl+R", description: "Reload prone" },
                { combo: "Ctrl+F1", description: "Switch class" },
                { combo: "Alt+V", description: "Change view" },
                { combo: "Middle Mouse", description: "Ping" },
                { combo: "Hold T", description: "Mark enemy" },
                { combo: "Hold Shift", description: "Sprint long" },
                { combo: "Hold F", description: "Plant/diffuse" },
                { combo: "Ctrl+Number", description: "Squad command" },
                { combo: "Shift+1-4", description: "Formations" },
                { combo: "K", description: "Kill feed" },
                { combo: "U", description: "Medkit" },
                { combo: "1", description: "Inventory" },
                { combo: "Backspace", description: "Suicide" },
                { combo: "Del", description: "Respawn" },
                { combo: "F3", description: "Record" },
                { combo: "F12", description: "Screenshot" },
                { combo: "Tilde", description: "Console" },
                { combo: "Ctrl+Alt+Delete", description: "Force quit" },
            ],
            "CODING_IDE_SHORTCUTS": [
                { combo: "Ctrl+P", description: "Quick open file" },
                { combo: "Ctrl+Shift+P", description: "Command palette" },
                { combo: "Ctrl+`", description: "Terminal toggle" },
                { combo: "Ctrl+B", description: "Sidebar toggle" },
                { combo: "Ctrl+J", description: "Panel toggle" },
                { combo: "Ctrl+Shift+E", description: "Explorer" },
                { combo: "Ctrl+Shift+F", description: "Search in files" },
                { combo: "Ctrl+Shift+G", description: "Git" },
                { combo: "Ctrl+Shift+D", description: "Debug" },
                { combo: "Ctrl+Shift+X", description: "Extensions" },
                { combo: "Ctrl+Space", description: "Trigger suggestion" },
                { combo: "Ctrl+/-", description: "Comment line" },
                { combo: "Alt+Up/Down", description: "Move line" },
                { combo: "Shift+Alt+Down", description: "Copy line down" },
                { combo: "Ctrl+Shift+K", description: "Delete line" },
                { combo: "Ctrl+D", description: "Select next occurrence" },
                { combo: "Ctrl+L", description: "Select line" },
                { combo: "Ctrl+Enter", description: "Insert line below" },
                { combo: "Ctrl+Shift+Enter", description: "Insert line above" },
                { combo: "Ctrl+Tab", description: "Next editor" },
                { combo: "Ctrl+Shift+Tab", description: "Previous editor" },
                { combo: "Ctrl+W", description: "Close editor" },
            ],
            "KICAD_SHORTCUTS": [
                { combo: "Ctrl+N", description: "New project" },
                { combo: "Ctrl+O", description: "Open project" },
                { combo: "Ctrl+S", description: "Save" },
                { combo: "Ctrl+Z", description: "Undo" },
                { combo: "Ctrl+Y", description: "Redo" },
                { combo: "Ctrl+C/V/X", description: "Copy/Paste/Cut" },
                { combo: "Del", description: "Delete" },
                { combo: "R", description: "Rotate" },
                { combo: "M", description: "Move" },
                { combo: "E", description: "Edit properties" },
                { combo: "W", description: "Wire" },
                { combo: "P", description: "Place component" },
                { combo: "Shift+Space", description: "Cycle units" },
                { combo: "Page Up/Down", description: "Zoom in/out" },
                { combo: "Ctrl+Scroll", description: "Zoom" },
                { combo: "F1/F2/F3/F4", description: "Pan directions" },
                { combo: "Space", description: "Reset origin" },
                { combo: "Alt+1-5", description: "Layer view" },
                { combo: "Ctrl+B", description: "Rebuild ratsnest" },
                { combo: "Ctrl+H", description: "Highlight net" },
            ],
            "FUSION_360_SHORTCUTS": [
                { combo: "S", description: "Toolbox" },
                { combo: "L", description: "Line" },
                { combo: "R", description: "Rectangle" },
                { combo: "C", description: "Circle" },
                { combo: "D", description: "Dimension" },
                { combo: "T", description: "Text" },
                { combo: "M", description: "Move" },
                { combo: "Q", description: "Press/Pull" },
                { combo: "E", description: "Extrude" },
                { combo: "F", description: "Fillet" },
                { combo: "Shift+S", description: "Sketch shortcuts" },
                { combo: "Ctrl+Z/Y", description: "Undo/Redo" },
                { combo: "Ctrl+C/V", description: "Copy/Paste" },
                { combo: "Delete", description: "Remove" },
                { combo: "B", description: "Emboss" },
                { combo: "J", description: "Joint" },
                { combo: "H", description: "Hole" },
                { combo: "G", description: "Grid settings" },
                { combo: "Tab", description: "Switch input" },
                { combo: "Alt+Drag", description: "Orbit" },
                { combo: "Shift+Scroll", description: "Pan" },
                { combo: "Scroll", description: "Zoom" },
                { combo: "Home", description: "View cube" },
                { combo: "F6", description: "Home view" },
                { combo: "F7", description: "Slice" },
                { combo: "Ctrl+1/2/3", description: "Orthographic views" },
                { combo: "Ctrl+Shift+E", description: "Export" },
                { combo: "Ctrl+S", description: "Save" },
            ],
            "CANVA_SHORTCUTS": [
                { combo: "Ctrl+C/V/X", description: "Copy/Paste/Cut" },
                { combo: "Ctrl+Z/Y", description: "Undo/Redo" },
                { combo: "Ctrl+A", description: "Select all" },
                { combo: "Delete", description: "Remove" },
                { combo: "Ctrl+G/U", description: "Group/Ungroup" },
                { combo: "Ctrl+D", description: "Duplicate" },
                { combo: "Shift+Arrow", description: "Nudge" },
                { combo: "Alt+Drag", description: "Duplicate while dragging" },
                { combo: "T", description: "Add text" },
                { combo: "R", description: "Add rectangle" },
                { combo: "L", description: "Add line" },
                { combo: "C", description: "Add circle" },
                { combo: "B", description: "Bold" },
                { combo: "I", description: "Italic" }, // Corrected from '1' to 'I' based on common Canva shortcuts
                { combo: "U", description: "Underline" },
                { combo: "Ctrl+K", description: "Link" },
                { combo: "Ctrl+Shift+K", description: "Unlink" },
                { combo: "Ctrl+E", description: "Align center" },
                { combo: "Ctrl+L/R", description: "Align left/right" },
                { combo: "Ctrl+Shift+M", description: "Comment" },
                { combo: "Alt+[/]", description: "Layer back/front" },
                { combo: "Ctrl+P", description: "Print" },
                { combo: "Ctrl+S", description: "Save" },
                { combo: "Ctrl+Shift+S", description: "Save As" },
                { combo: "Ctrl+Shift+D", description: "Download" },
            ],
            // The "MACRO" category will be dynamically populated based on the 'macros' state
            // "MEDIA", "LAYERS", "SPECIAL", "QMK LIGHTING" remain static presets
            "MEDIA": [
                { combo: "KC_MPRV", description: "Prev Track" },
                { combo: "KC_MNXT", description: "Next Track" },
                { combo: "KC_MPLY", description: "Play/Pause" },
                { combo: "KC_MUTE", description: "Mute" },
                { combo: "KC_VOLU", description: "Volume Up" },
                { combo: "KC_VOLD", description: "Volume Down" },
            ],
            "LAYERS": [
                { combo: "TG(1)", description: "Toggle Layer 1" },
                { combo: "MO(1)", description: "Momentary Layer 1" },
                { combo: "TO(0)", description: "To Layer 0" },
            ],
            "SPECIAL": [
                { combo: "KC_PWR", description: "Power" },
                { combo: "KC_SLEP", description: "Sleep" },
                { combo: "KC_WAKE", description: "Wake" },
            ],
            "QMK LIGHTING": [
                { combo: "RGB_TOG", description: "RGB Toggle" },
                { combo: "RGB_MOD", description: "RGB Mode" },
                { combo: "RGB_HUI", description: "Hue Inc" },
                { combo: "RGB_HUD", description: "Hue Dec" },
                { combo: "RGB_SAI", description: "Sat Inc" },
                { combo: "RGB_SAD", description: "Sat Dec" },
                { combo: "RGB_VAI", description: "Val Inc" },
                { combo: "RGB_VAD", description: "Val Dec" },
            ]
        };
        // --- END OF PRESETS DATA ---

        // --- START OF TRANSLATIONS DATA ---
        const translations = {
            "appTitle": {
                "en": "Trkey Keymap Configurator",
                "ko": "트키 키맵 설정기",
                "es": "Configurador de Teclado Trkey"
            },
            "keymapTab": {
                "en": "KEYMAP",
                "ko": "키맵",
                "es": "MAPA DE TECLAS"
            },
            "macrosTab": {
                "en": "MACROS",
                "ko": "매크로",
                "es": "MACROS"
            },
            "settingsTab": {
                "en": "SETTINGS",
                "ko": "설정",
                "es": "AJUSTES"
            },
            "mapUploadTab": { // New translation key for Map Upload tab
                "en": "MAP UPLOAD",
                "ko": "맵 업로드",
                "es": "CARGA DE MAPA"
            },
            "keyTesterTab": {
                "en": "KEY TESTER",
                "ko": "키 테스터",
                "es": "PROBADOR DE TECLAS"
            },
            "githubLink": {
                "en": "GITHUB",
                "ko": "깃허브",
                "es": "GITHUB"
            },
            "version": {
                "en": "Version",
                "ko": "버전",
                "es": "Versión"
            },
            "builtBy": { // New translation key for "Built by"
                "en": "Built by",
                "ko": "제작자",
                "es": "Construido por"
            },
            "keySelectedTitle": {
                "en": "Key Selected",
                "ko": "키 선택됨",
                "es": "Tecla Seleccionada"
            },
            "keySelectedMessage": {
                "en": "Key at row {row}, column {col} selected. Now click a shortcut from the pool to assign it.",
                "ko": "행 {row}, 열 {col}의 키가 선택되었습니다. 이제 풀에서 단축키를 클릭하여 할당하세요.",
                "es": "Tecla en fila {row}, columna {col} seleccionada. Ahora haga clic en un atajo del grupo para asignarlo."
            },
            "shortcutMappedTitle": {
                "en": "Shortcut Mapped",
                "ko": "단축키 매핑됨",
                "es": "Atajo Mapeado"
            },
            "shortcutMappedMessage": {
                "en": "Shortcut \"{shortcut}\" mapped to key at row {row}, column {col}.",
                "ko": "단축키 \"{shortcut}\"이(가) 행 {row}, 열 {col}의 키에 매핑되었습니다.",
                "es": "Atajo \"{shortcut}\" mapeado a la tecla en fila {row}, columna {col}."
            },
            "noKeySelectedTitle": {
                "en": "No Key Selected",
                "ko": "선택된 키 없음",
                "es": "Ninguna Tecla Seleccionada"
            },
            "noKeySelectedMessage": {
                "en": "Please select a key on the keymap grid first, then click a shortcut to assign it.",
                "ko": "먼저 키맵 그리드에서 키를 선택한 다음, 단축키를 클릭하여 할당하세요.",
                "es": "Por favor, seleccione una tecla en la cuadrícula del mapa de teclas primero, luego haga clic en un atajo para asignarlo."
            },
            "profileSavedTitle": {
                "en": "Profile Saved",
                "ko": "프로필 저장됨",
                "es": "Perfil Guardado"
            },
            "profileSavedMessage": {
                "en": "Your current keymap and macros have been saved to your browser's local storage.",
                "ko": "현재 키맵과 매크로가 브라우저의 로컬 저장소에 저장되었습니다.",
                "es": "Su mapa de teclas y macros actuales se han guardado en el almacenamiento local de su navegador."
            },
            "profileLoadedTitle": {
                "en": "Profile Loaded",
                "ko": "프로필 불러옴",
                "es": "Perfil Cargado"
            },
            "profileLoadedMessage": {
                "en": "Profile loaded successfully from browser storage.",
                "ko": "브라우저 저장소에서 프로필을 성공적으로 불러왔습니다.",
                "es": "Perfil cargado exitosamente desde el almacenamiento del navegador."
            },
            "noProfileFoundTitle": {
                "en": "No Profile Found",
                "ko": "프로필을 찾을 수 없음",
                "es": "No se Encontró Perfil"
            },
            "noProfileFoundMessage": {
                "en": "No saved profile found in browser storage.",
                "ko": "브라우저 저장소에서 저장된 프로필을 찾을 수 없습니다.",
                "es": "No se encontró ningún perfil guardado en el almacenamiento del navegador."
            },
            "exportSuccessfulTitle": {
                "en": "Export Successful",
                "ko": "내보내기 성공",
                "es": "Exportación Exitosa"
            },
            "exportSuccessfulMessage": {
                "en": "Configuration exported as trkey_config.json.",
                "ko": "설정이 trkey_config.json으로 내보내졌습니다.",
                "es": "Configuración exportada como trkey_config.json."
            },
            "webSerialApiNotSupportedTitle": {
                "en": "Web Serial API Not Supported",
                "ko": "웹 시리얼 API 미지원",
                "es": "API Serial Web No Compatible"
            },
            "webSerialApiNotSupportedMessage": {
                "en": "Your browser does not support the Web Serial API. Please use a Chromium-based browser (e.g., Chrome, Edge) for this feature.",
                "ko": "귀하의 브라우저는 웹 시리얼 API를 지원하지 않습니다. 이 기능을 사용하려면 크롬 기반 브라우저(예: Chrome, Edge)를 사용하세요.",
                "es": "Su navegador no es compatible con la API Serial Web. Por favor, use un navegador basado en Chromium (ej., Chrome, Edge) para esta función."
            },
            "deviceConnectedTitle": {
                "en": "Device Connected",
                "ko": "장치 연결됨",
                "es": "Dispositivo Conectado"
            },
            "deviceConnectedMessage": {
                "en": "Micropad connected successfully. You can now upload your keymap.",
                "ko": "마이크로패드가 성공적으로 연결되었습니다. 이제 키맵을 업로드할 수 있습니다.",
                "es": "Micropad conectado exitosamente. Ahora puede cargar su mapa de teclas."
            },
            "connectionFailedTitle": {
                "en": "Connection Failed",
                "ko": "연결 실패",
                "es": "Conexión Fallida"
            },
            "connectionFailedMessage": {
                "en": "Failed to connect to device: {error}. Please ensure the device is ready to receive data (e.g., in programming mode or awaiting input).",
                "ko": "장치 연결 실패: {error}. 장치가 데이터를 수신할 준비가 되었는지 확인하세요 (예: 프로그래밍 모드 또는 입력 대기 중).",
                "es": "Fallo al conectar con el dispositivo: {error}. Asegúrese de que el dispositivo esté listo para recibir datos (ej., en modo de programación o esperando entrada)."
            },
            "disconnectedTitle": {
                "en": "Disconnected",
                "ko": "연결 해제됨",
                "es": "Desconectado"
            },
            "disconnectedMessage": {
                "en": "Micropad disconnected successfully.",
                "ko": "마이크로패드가 성공적으로 연결 해제되었습니다.",
                "es": "Micropad desconectado exitosamente."
            },
            "disconnectionFailedTitle": {
                "en": "Disconnection Failed",
                "ko": "연결 해제 실패",
                "es": "Fallo al Desconectar"
            },
            "disconnectionFailedMessage": {
                "en": "Failed to disconnect: {error}",
                "ko": "연결 해제 실패: {error}",
                "es": "Fallo al desconectar: {error}"
            },
            "noDeviceConnectedTitle": {
                "en": "No Device Connected",
                "ko": "장치 연결 안됨",
                "es": "Ningún Dispositivo Conectado"
            },
            "noDeviceConnectedMessage": {
                "en": "Please connect to your micropad first.",
                "ko": "먼저 마이크로패드를 연결하세요.",
                "es": "Por favor, conecte su micropad primero."
            },
            "uploadSuccessfulTitle": {
                "en": "Upload Successful",
                "ko": "업로드 성공",
                "es": "Carga Exitosa"
            },
            "uploadSuccessfulMessage": {
                "en": "Keymap uploaded successfully to ESP32C3!",
                "ko": "키맵이 ESP32C3에 성공적으로 업로드되었습니다!",
                "es": "¡Mapa de teclas cargado exitosamente al ESP32C3!"
            },
            "uploadFailedTitle": {
                "en": "Upload Failed",
                "ko": "업로드 실패",
                "es": "Fallo en la Carga"
            },
            "uploadFailedMessage": {
                "en": "Failed to upload keymap: {error}. Please ensure your ESP32C3 is running a web server and the correct endpoint is configured.",
                "ko": "키맵 업로드 실패: {error}. ESP32C3가 웹 서버를 실행 중이고 올바른 엔드포인트가 구성되었는지 확인하세요.",
                "es": "Fallo al cargar el mapa de teclas: {error}. Asegúrese de que su ESP32C3 esté ejecutando un servidor web y que el endpoint correcto esté configurado."
            },
            "selectJsonFile": {
                "en": "Select JSON File",
                "ko": "JSON 파일 선택",
                "es": "Seleccionar Archivo JSON"
            },
            "uploadFile": {
                "en": "Upload File",
                "ko": "파일 업로드",
                "es": "Subir Archivo"
            },
            "fileSelected": {
                "en": "File selected: {fileName}",
                "ko": "선택된 파일: {fileName}",
                "es": "Archivo seleccionado: {fileName}"
            },
            "noFileSelected": {
                "en": "No file selected.",
                "ko": "선택된 파일 없음.",
                "es": "Ningún archivo seleccionado."
            },
            // ... (rest of your translations)
        };
        // --- END OF TRANSLATIONS DATA ---

        // Macro Form Modal Component
        const MacroFormModal = ({ show, onClose, onSave, macro, language }) => {
            const [name, setName] = useState('');
            const [sequence, setSequence] = useState('');
            const [delay, setDelay] = useState('100');

            useEffect(() => {
                if (macro) {
                    setName(macro.name);
                    setSequence(macro.sequence.join(' ')); // Join array for display
                    setDelay(macro.delay ? macro.delay.toString() : '100');
                } else {
                    setName('');
                    setSequence('');
                    setDelay('100');
                }
            }, [macro]);

            const handleSubmit = (e) => {
                e.preventDefault();
                const macroToSave = {
                    id: macro ? macro.id : Date.now(), // Use existing ID or generate new
                    name,
                    sequence: sequence.split(' ').filter(s => s), // Split by space, remove empty strings
                    delay: parseInt(delay, 10)
                };
                onSave(macroToSave);
                onClose();
            };

            if (!show) return null;

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-zinc-700 p-6 rounded-lg shadow-xl w-96">
                        <h2 className="text-xl font-bold mb-4 text-white">{macro ? "Edit Macro" : "Add New Macro"}</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="mb-4">
                                <label htmlFor="macroName" className="block text-sm font-medium text-gray-300">Macro Name</label>
                                <input
                                    type="text"
                                    id="macroName"
                                    className="mt-1 block w-full px-3 py-2 bg-zinc-800 border border-zinc-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                    value={name}
                                    onChange={(e) => setName(e.target.value)}
                                    required
                                />
                            </div>
                            <div className="mb-4">
                                <label htmlFor="macroSequence" className="block text-sm font-medium text-gray-300">Key Sequence (space-separated)</label>
                                <input
                                    type="text"
                                    id="macroSequence"
                                    className="mt-1 block w-full px-3 py-2 bg-zinc-800 border border-zinc-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                    value={sequence}
                                    onChange={(e) => setSequence(e.target.value)}
                                    placeholder="e.g., LCTRL LALT DEL"
                                    required
                                />
                            </div>
                            <div className="mb-4">
                                <label htmlFor="macroDelay" className="block text-sm font-medium text-gray-300">Delay between keys (ms)</label>
                                <input
                                    type="number"
                                    id="macroDelay"
                                    className="mt-1 block w-full px-3 py-2 bg-zinc-800 border border-zinc-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                    value={delay}
                                    onChange={(e) => setDelay(e.target.value)}
                                    min="0"
                                />
                            </div>
                            <div className="flex justify-end space-x-2">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition duration-200"
                                >
                                    Cancel
                                </button>
                                <button
                                    type="submit"
                                    className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-200"
                                >
                                    {macro ? "Save Changes" : "Add Macro"}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // Confirmation Modal Component
        const ConfirmationModal = ({ show, onClose, onConfirm, message, language }) => {
            if (!show) return null;

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-zinc-700 p-6 rounded-lg shadow-xl w-96">
                        <h2 className="text-xl font-bold mb-4 text-white">Confirm Action</h2>
                        <p className="text-gray-300 mb-6">{message}</p>
                        <div className="flex justify-end space-x-2">
                            <button
                                type="button"
                                onClick={onClose}
                                className="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition duration-200"
                            >
                                {translations.cancel[language]}
                            </button>
                            <button
                                type="button"
                                onClick={onConfirm}
                                className="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition duration-200"
                            >
                                {translations.delete[language]}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Add Shortcut Modal Component
        const AddShortcutModal = ({ show, onClose, onSave, language }) => {
            const [name, setName] = useState('');
            const [combo, setCombo] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave({ name, combo });
                setName('');
                setCombo('');
                onClose();
            };

            if (!show) return null;

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-zinc-700 p-6 rounded-lg shadow-xl w-96">
                        <h2 className="text-xl font-bold mb-4 text-white">Add Custom Shortcut</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="mb-4">
                                <label htmlFor="shortcutName" className="block text-sm font-medium text-gray-300">Shortcut Name (e.g., "Open Browser")</label>
                                <input
                                    type="text"
                                    id="shortcutName"
                                    className="mt-1 block w-full px-3 py-2 bg-zinc-800 border border-zinc-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                    value={name}
                                    onChange={(e) => setName(e.target.value)}
                                    required
                                />
                            </div>
                            <div className="mb-4">
                                <label htmlFor="shortcutCombo" className="block text-sm font-medium text-gray-300">Firmware Combo (e.g., "LGUI R")</label>
                                <input
                                    type="text"
                                    id="shortcutCombo"
                                    className="mt-1 block w-full px-3 py-2 bg-zinc-800 border border-zinc-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                    value={combo}
                                    onChange={(e) => setCombo(e.target.value)}
                                    placeholder="e.g., LCTRL LALT DEL or A"
                                    required
                                />
                            </div>
                            <div className="flex justify-end space-x-2">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition duration-200"
                                >
                                    {translations.cancel[language]}
                                </button>
                                <button
                                    type="submit"
                                    className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-200"
                                >
                                    Add Shortcut
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };


        // Notification Component
        const Notification = ({ message, type, onClose }) => {
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            const textColor = 'text-white';

            useEffect(() => {
                const timer = setTimeout(() => {
                    onClose();
                }, 3000); // Notification disappears after 3 seconds
                return () => clearTimeout(timer);
            }, [onClose]);

            return (
                <div className={`fixed bottom-4 right-4 p-4 rounded-lg shadow-lg ${bgColor} ${textColor} z-50`}>
                    {message}
                </div>
            );
        };


        // Keymap Grid Component
        const KeymapGrid = ({ keymap, onKeyClick, selectedKey, language, translations }) => {
            return (
                <div className="grid grid-cols-3 gap-4 p-4 bg-zinc-700 rounded-lg shadow-lg">
                    {keymap.map((row, rowIndex) => (
                        row.map((key, colIndex) => (
                            <button
                                key={`${rowIndex}-${colIndex}`}
                                className={`
                                    flex flex-col items-center justify-center p-4 rounded-lg
                                    transition-all duration-200 ease-in-out
                                    ${selectedKey && selectedKey.row === rowIndex && selectedKey.col === colIndex
                                        ? 'bg-blue-600 ring-2 ring-blue-400'
                                        : 'bg-zinc-600 hover:bg-zinc-500'
                                    }
                                    text-white font-semibold h-24 w-24
                                `}
                                onClick={() => onKeyClick(rowIndex, colIndex)}
                            >
                                <span className="text-lg">{key.name || translations.empty[language]}</span>
                                <span className="text-xs text-gray-300 overflow-hidden text-ellipsis whitespace-nowrap w-full text-center">{key.combo}</span>
                            </button>
                        ))
                    ))}
                </div>
            );
        };

        // Key Tester Component
        const KeyTester = () => {
            const [lastPressedKey, setLastPressedKey] = useState('');
            const [keyLog, setKeyLog] = useState([]);
            const logRef = useRef(null);

            useEffect(() => {
                const handleKeyDown = (event) => {
                    setLastPressedKey(event.key === ' ' ? 'Space' : event.key);
                    setKeyLog(prevLog => {
                        const newLog = [...prevLog, event.key === ' ' ? 'Space' : event.key];
                        // Keep log to max 10 entries for display
                        return newLog.slice(-10);
                    });
                };

                const handleKeyUp = (event) => {
                    // You might want to track key up for release events if needed
                };

                window.addEventListener('keydown', handleKeyDown);
                window.addEventListener('keyup', handleKeyUp);

                return () => {
                    window.removeEventListener('keydown', handleKeyDown);
                    window.removeEventListener('keyup', handleKeyUp);
                };
            }, []);

            useEffect(() => {
                if (logRef.current) {
                    logRef.current.scrollTop = logRef.current.scrollHeight; // Scroll to bottom
                }
            }, [keyLog]);

            return (
                <div className="flex flex-col items-center justify-center min-h-[calc(100vh-160px)] p-4 bg-zinc-800 rounded-lg">
                    <h2 className="text-3xl font-bold text-white mb-6">Key Tester</h2>
                    <div className="bg-zinc-700 p-8 rounded-lg shadow-xl text-center w-full max-w-md">
                        <p className="text-gray-300 text-lg mb-4">Press any key on your keyboard...</p>
                        <div className="text-6xl font-bold text-blue-400 min-h-[80px] flex items-center justify-center">
                            {lastPressedKey || '-'}
                        </div>
                        <p className="text-gray-400 text-sm mt-6">Last 10 pressed keys:</p>
                        <div ref={logRef} className="bg-zinc-600 text-gray-200 p-3 rounded-md h-32 overflow-y-auto text-left scrollbar-hide">
                            {keyLog.length === 0 ? (
                                <p className="text-gray-400">No keys pressed yet.</p>
                            ) : (
                                keyLog.map((key, index) => (
                                    <p key={index} className="py-0.5">{key}</p>
                                ))
                            )}
                        </div>
                    </div>
                </div>
            );
        };


        // New MapUploadTab Component
        const MapUploadTab = ({ language, translations, onShowNotification }) => {
            const [selectedFile, setSelectedFile] = useState(null);
            const fileInputRef = useRef(null);

            const handleFileChange = (event) => {
                const file = event.target.files[0];
                if (file && file.type === "application/json") {
                    setSelectedFile(file);
                    onShowNotification(translations.fileSelected[language].replace('{fileName}', file.name), 'success');
                } else {
                    setSelectedFile(null);
                    onShowNotification("Please select a valid JSON file.", 'error');
                }
            };

            const handleUploadJson = async () => {
                if (!selectedFile) {
                    onShowNotification(translations.noFileSelected[language], 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = async (e) => {
                    const jsonContent = e.target.result;
                    const esp32IpAddress = "http://<YOUR_ESP32_IP_ADDRESS>"; // IMPORTANT: Replace with your ESP32C3's actual IP address
                    const uploadEndpoint = "/upload_keymap"; // This endpoint must be handled by your ESP32C3 web server

                    try {
                        const response = await fetch(`${esp32IpAddress}${uploadEndpoint}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: jsonContent,
                        });

                        if (response.ok) {
                            onShowNotification(translations.uploadSuccessfulMessage[language], 'success');
                            setSelectedFile(null); // Clear selected file after successful upload
                            if (fileInputRef.current) {
                                fileInputRef.current.value = ""; // Clear file input
                            }
                        } else {
                            const errorText = await response.text();
                            onShowNotification(translations.uploadFailedMessage[language].replace('{error}', errorText), 'error');
                        }
                    } catch (error) {
                        onShowNotification(translations.uploadFailedMessage[language].replace('{error}', error.message), 'error');
                    }
                };
                reader.readAsText(selectedFile);
            };

            return (
                <div className="flex flex-col items-center justify-center min-h-[calc(100vh-160px)] p-4 bg-zinc-800 rounded-lg">
                    <h2 className="text-3xl font-bold text-white mb-6">{translations.mapUploadTab[language]}</h2>
                    <div className="bg-zinc-700 p-8 rounded-lg shadow-xl text-center w-full max-w-md">
                        <p className="text-gray-300 text-lg mb-4">{translations.selectJsonFile[language]}</p>
                        <input
                            type="file"
                            accept=".json"
                            onChange={handleFileChange}
                            ref={fileInputRef}
                            className="block w-full text-sm text-gray-300
                                       file:mr-4 file:py-2 file:px-4
                                       file:rounded-full file:border-0
                                       file:text-sm file:font-semibold
                                       file:bg-blue-50 file:text-blue-700
                                       hover:file:bg-blue-100 mb-6"
                        />
                        <button
                            onClick={handleUploadJson}
                            className="w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                            disabled={!selectedFile}
                        >
                            {translations.uploadFile[language]}
                        </button>
                        {selectedFile && (
                            <p className="text-sm text-gray-400 mt-4">
                                {translations.fileSelected[language].replace('{fileName}', selectedFile.name)}
                            </p>
                        )}
                    </div>
                </div>
            );
        };


        const App = () => {
            // State for managing selected tab, keymap, and macros
            const [activeTab, setActiveTab] = useState('keymap'); // 'keymap', 'macros', 'settings', 'mapUpload', 'keyTester'
            const [language, setLanguage] = useState('en'); // Default language
            const [keymap, setKeymap] = useState(() => {
                const savedKeymap = localStorage.getItem('trkeyKeymap');
                return savedKeymap ? JSON.parse(savedKeymap) : Array(3).fill(null).map(() => Array(3).fill({ name: translations.empty[language], combo: '' }));
            });
            const [macros, setMacros] = useState(() => {
                const savedMacros = localStorage.getItem('trkeyMacros');
                return savedMacros ? JSON.parse(savedMacros) : [];
            });

            // State for key selection and modal visibility
            const [selectedKey, setSelectedKey] = useState(null);
            const [showMacroFormModal, setShowMacroFormModal] = useState(false);
            const [editingMacro, setEditingMacro] = useState(null);
            const [showConfirmationModal, setShowConfirmationModal] = useState(false);
            const [macroToDelete, setMacroToDelete] = useState(null);
            const [showAddShortcutModal, setShowAddShortcutModal] = useState(false);

            // State for notifications
            const [notification, setNotification] = useState(null);

            // Web Serial API state
            const [port, setPort] = useState(null);

            // Update keymap and macros in local storage whenever they change
            useEffect(() => {
                localStorage.setItem('trkeyKeymap', JSON.stringify(keymap));
            }, [keymap]);

            useEffect(() => {
                localStorage.setItem('trkeyMacros', JSON.stringify(macros));
            }, [macros]);

            // Dynamically add the "MACRO" preset based on current macros
            useEffect(() => {
                presets.MACRO = macros.map(m => ({
                    combo: `MACRO(${m.id})`, // Assuming firmware uses MACRO(id) to trigger
                    description: m.name
                }));
            }, [macros]);

            // Callback for showing notifications
            const handleShowNotification = useCallback((message, type) => {
                setNotification({ message, type });
            }, []);

            // Callback for clearing notifications
            const handleCloseNotification = useCallback(() => {
                setNotification(null);
            }, []);

            // Handle key click on the keymap grid
            const handleKeyClick = (rowIndex, colIndex) => {
                setSelectedKey({ row: rowIndex, col: colIndex });
                handleShowNotification(
                    translations.keySelectedMessage[language]
                        .replace('{row}', rowIndex + 1)
                        .replace('{col}', colIndex + 1),
                    'info'
                );
            };

            // Handle shortcut assignment
            const handleShortcutAssign = (combo, description) => {
                if (selectedKey) {
                    const newKeymap = keymap.map((row, rIdx) =>
                        row.map((key, cIdx) =>
                            (rIdx === selectedKey.row && cIdx === selectedKey.col)
                                ? { name: description, combo: combo }
                                : key
                        )
                    );
                    setKeymap(newKeymap);
                    handleShowNotification(
                        translations.shortcutMappedMessage[language]
                            .replace('{shortcut}', description)
                            .replace('{row}', selectedKey.row + 1)
                            .replace('{col}', selectedKey.col + 1),
                        'success'
                    );
                    setSelectedKey(null); // Clear selection after assignment
                } else {
                    handleShowNotification(translations.noKeySelectedMessage[language], 'error');
                }
            };

            // CRUD for Macros
            const handleAddMacro = () => {
                setEditingMacro(null); // Clear any existing macro for new creation
                setShowMacroFormModal(true);
            };

            const handleEditMacro = (macro) => {
                setEditingMacro(macro);
                setShowMacroFormModal(true);
            };

            const handleSaveMacro = (newMacro) => {
                if (newMacro.id === undefined || !macros.some(m => m.id === newMacro.id)) {
                    // Add new macro
                    setMacros([...macros, newMacro]);
                } else {
                    // Update existing macro
                    setMacros(macros.map(m => (m.id === newMacro.id ? newMacro : m)));
                }
                setShowMacroFormModal(false);
                setEditingMacro(null);
            };

            const handleDeleteMacro = (macroId) => {
                setMacroToDelete(macroId);
                setShowConfirmationModal(true);
            };

            const confirmDeleteMacro = () => {
                setMacros(macros.filter(m => m.id !== macroToDelete));
                setShowConfirmationModal(false);
                setMacroToDelete(null);
            };

            // Add custom shortcuts
            const handleSaveNewShortcut = (newShortcut) => {
                const newAllButtons = [...allKeyboardButtons, { name: newShortcut.name, combo: newShortcut.combo }];
                // Update the "STANDARD_KEYS" preset with the new list
                presets.STANDARD_KEYS = newAllButtons;
                // You might also want to save this to local storage if it should persist
                handleShowNotification("Custom shortcut added!", 'success');
                setShowAddShortcutModal(false);
            };

            // Profile Management (Save/Load)
            const handleSaveProfile = () => {
                localStorage.setItem('trkeyKeymap', JSON.stringify(keymap));
                localStorage.setItem('trkeyMacros', JSON.stringify(macros));
                handleShowNotification(translations.profileSavedMessage[language], 'success');
            };

            const handleLoadProfile = () => {
                const savedKeymap = localStorage.getItem('trkeyKeymap');
                const savedMacros = localStorage.getItem('trkeyMacros');
                if (savedKeymap && savedMacros) {
                    setKeymap(JSON.parse(savedKeymap));
                    setMacros(JSON.parse(savedMacros));
                    handleShowNotification(translations.profileLoadedMessage[language], 'success');
                } else {
                    handleShowNotification(translations.noProfileFoundMessage[language], 'error');
                }
            };

            const handleExportConfig = () => {
                const config = {
                    keymap: keymap.map(row => row.map(key => key.combo)), // Exporting only combos
                    macros: macros.map(m => ({ id: m.id, name: m.name, sequence: m.sequence, delay: m.delay }))
                };
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(config, null, 2));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "trkey_config.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
                handleShowNotification(translations.exportSuccessfulMessage[language], 'success');
            };

            // Web Serial API functions
            const connectSerial = async () => {
                if (!('serial' in navigator)) {
                    handleShowNotification(translations.webSerialApiNotSupportedMessage[language], 'error');
                    return;
                }
                try {
                    const connectedPort = await navigator.serial.requestPort();
                    await connectedPort.open({ baudRate: 115200 });
                    setPort(connectedPort);
                    handleShowNotification(translations.deviceConnectedMessage[language], 'success');
                } catch (error) {
                    handleShowNotification(translations.connectionFailedMessage[language].replace('{error}', error.message), 'error');
                    setPort(null);
                }
            };

            const disconnectSerial = async () => {
                if (port) {
                    try {
                        await port.close();
                        setPort(null);
                        handleShowNotification(translations.disconnectedMessage[language], 'success');
                    } catch (error) {
                        handleShowNotification(translations.disconnectionFailedMessage[language].replace('{error}', error.message), 'error');
                    }
                } else {
                    handleShowNotification(translations.noDeviceConnectedMessage[language], 'error');
                }
            };

            // Function to send data via Web Serial (placeholder for actual implementation)
            const sendDataSerial = async (data) => {
                if (!port) {
                    handleShowNotification(translations.noDeviceConnectedMessage[language], 'error');
                    return;
                }
                try {
                    const encoder = new TextEncoder();
                    const writer = port.writable.getWriter();
                    await writer.write(encoder.encode(data + '\n')); // Send data with newline
                    writer.releaseLock();
                    handleShowNotification("Data sent via serial!", 'success');
                } catch (error) {
                    handleShowNotification(`Failed to send data: ${error.message}`, 'error');
                }
            };

            const uploadKeymapViaSerial = async () => {
                if (!port) {
                    handleShowNotification(translations.noDeviceConnectedMessage[language], 'error');
                    return;
                }

                // Prepare keymap and macros in a format suitable for the ESP32C3 firmware
                const firmwareConfig = {
                    keymap: keymap.map(row => row.map(key => key.combo)),
                    macros: macros
                };
                const configString = JSON.stringify(firmwareConfig);

                try {
                    // Assuming the ESP32C3 firmware has a serial command to initiate keymap upload
                    // You would send a specific command, then the JSON data
                    await sendDataSerial("UPLOAD_KEYMAP_START"); // Command to tell ESP32 to prepare
                    await sendDataSerial(configString);          // The actual JSON data
                    await sendDataSerial("UPLOAD_KEYMAP_END");   // Command to tell ESP32 to finalize

                    handleShowNotification(translations.uploadSuccessfulMessage[language], 'success');
                } catch (error) {
                    handleShowNotification(translations.uploadFailedMessage[language].replace('{error}', error.message), 'error');
                }
            };


            return (
                <div className="min-h-screen bg-zinc-800 text-white flex flex-col items-center p-4">
                    <header className="w-full max-w-5xl bg-zinc-900 rounded-lg shadow-xl p-4 mb-6 flex flex-col md:flex-row justify-between items-center">
                        <h1 className="text-3xl font-bold mb-4 md:mb-0">{translations.appTitle[language]}</h1>
                        <div className="flex space-x-2">
                            <select
                                value={language}
                                onChange={(e) => setLanguage(e.target.value)}
                                className="bg-zinc-700 text-white p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                            >
                                <option value="en">English</option>
                                <option value="ko">한국어</option>
                                <option value="es">Español</option>
                            </select>
                            <a
                                href="https://github.com/your-repo-link" // Replace with your GitHub link
                                target="_blank"
                                rel="noopener noreferrer"
                                className="px-4 py-2 bg-zinc-700 text-white rounded-md hover:bg-zinc-600 transition duration-200 flex items-center"
                            >
                                <span className="mr-2">{translations.githubLink[language]}</span>
                                {/* Optional: Add a GitHub icon */}
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" className="bi bi-github" viewBox="0 0 16 16">
                                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.03 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38C13.71 14.53 16 11.54 16 8c0-4.42-3.58-8-8-8"/>
                                </svg>
                            </a>
                        </div>
                    </header>

                    <nav className="w-full max-w-5xl bg-zinc-700 rounded-lg shadow-xl p-2 mb-6 flex flex-wrap justify-center gap-2">
                        <button
                            className={`px-4 py-2 rounded-md font-semibold transition duration-200 ${activeTab === 'keymap' ? 'bg-blue-600 text-white' : 'bg-zinc-600 text-gray-300 hover:bg-zinc-500'}`}
                            onClick={() => setActiveTab('keymap')}
                        >
                            {translations.keymapTab[language]}
                        </button>
                        <button
                            className={`px-4 py-2 rounded-md font-semibold transition duration-200 ${activeTab === 'macros' ? 'bg-blue-600 text-white' : 'bg-zinc-600 text-gray-300 hover:bg-zinc-500'}`}
                            onClick={() => setActiveTab('macros')}
                        >
                            {translations.macrosTab[language]}
                        </button>
                        <button
                            className={`px-4 py-2 rounded-md font-semibold transition duration-200 ${activeTab === 'settings' ? 'bg-blue-600 text-white' : 'bg-zinc-600 text-gray-300 hover:bg-zinc-500'}`}
                            onClick={() => setActiveTab('settings')}
                        >
                            {translations.settingsTab[language]}
                        </button>
                        <button
                            className={`px-4 py-2 rounded-md font-semibold transition duration-200 ${activeTab === 'mapUpload' ? 'bg-blue-600 text-white' : 'bg-zinc-600 text-gray-300 hover:bg-zinc-500'}`}
                            onClick={() => setActiveTab('mapUpload')}
                        >
                            {translations.mapUploadTab[language]}
                        </button>
                        <button
                            className={`px-4 py-2 rounded-md font-semibold transition duration-200 ${activeTab === 'keyTester' ? 'bg-blue-600 text-white' : 'bg-zinc-600 text-gray-300 hover:bg-zinc-500'}`}
                            onClick={() => setActiveTab('keyTester')}
                        >
                            {translations.keyTesterTab[language]}
                        </button>
                    </nav>

                    <main className="w-full max-w-5xl bg-zinc-800 rounded-lg shadow-xl p-4 flex flex-col md:flex-row gap-6">
                        {activeTab === 'keymap' && (
                            <>
                                <div className="flex-1 min-w-[300px]">
                                    <KeymapGrid
                                        keymap={keymap}
                                        onKeyClick={handleKeyClick}
                                        selectedKey={selectedKey}
                                        language={language}
                                        translations={translations}
                                    />
                                    <div className="mt-6 flex flex-wrap gap-4 justify-center">
                                        <button
                                            onClick={handleSaveProfile}
                                            className="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition duration-200"
                                        >
                                            {translations.saveProfile[language]}
                                        </button>
                                        <button
                                            onClick={handleLoadProfile}
                                            className="px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 transition duration-200"
                                        >
                                            {translations.loadProfile[language]}
                                        </button>
                                        <button
                                            onClick={handleExportConfig}
                                            className="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition duration-200"
                                        >
                                            {translations.exportConfig[language]}
                                        </button>
                                    </div>
                                </div>
                                <div className="flex-1 min-w-[300px] p-4 bg-zinc-700 rounded-lg shadow-inner overflow-y-auto scrollbar-hide max-h-[700px]">
                                    <h3 className="text-xl font-bold mb-4">Shortcut Pool</h3>
                                    {Object.keys(presets).map(category => (
                                        <div key={category} className="mb-4">
                                            <h4 className="text-lg font-semibold text-gray-300 mb-2">{category.replace(/_/g, ' ')}</h4>
                                            <div className="flex flex-wrap gap-2">
                                                {presets[category].map((shortcut, index) => (
                                                    <button
                                                        key={`${category}-${index}`}
                                                        className="px-3 py-1 bg-zinc-600 text-gray-200 rounded-md text-sm hover:bg-zinc-500 transition duration-150"
                                                        onClick={() => handleShortcutAssign(shortcut.combo, shortcut.description)}
                                                        title={shortcut.combo}
                                                    >
                                                        {shortcut.description}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                    <div className="mt-4 pt-4 border-t border-zinc-600">
                                        <button
                                            onClick={() => setShowAddShortcutModal(true)}
                                            className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-200"
                                        >
                                            Add Custom Shortcut
                                        </button>
                                    </div>
                                </div>
                            </>
                        )}

                        {activeTab === 'macros' && (
                            <div className="w-full p-4 bg-zinc-700 rounded-lg shadow-inner">
                                <h2 className="text-2xl font-bold mb-4">Your Macros</h2>
                                <button
                                    onClick={handleAddMacro}
                                    className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-200 mb-4"
                                >
                                    Add New Macro
                                </button>
                                {macros.length === 0 ? (
                                    <p className="text-gray-400">No macros defined yet. Click "Add New Macro" to get started.</p>
                                ) : (
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        {macros.map(macro => (
                                            <div key={macro.id} className="bg-zinc-600 p-4 rounded-lg shadow flex flex-col justify-between">
                                                <div>
                                                    <h3 className="text-xl font-semibold text-white">{macro.name}</h3>
                                                    <p className="text-gray-300 text-sm">Sequence: {macro.sequence.join(' ')}</p>
                                                    <p className="text-gray-400 text-xs">Delay: {macro.delay}ms</p>
                                                </div>
                                                <div className="mt-4 flex space-x-2">
                                                    <button
                                                        onClick={() => handleEditMacro(macro)}
                                                        className="px-3 py-1 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 transition duration-200 text-sm"
                                                    >
                                                        Edit
                                                    </button>
                                                    <button
                                                        onClick={() => handleDeleteMacro(macro.id)}
                                                        className="px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 transition duration-200 text-sm"
                                                    >
                                                        Delete
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'settings' && (
                            <div className="w-full p-4 bg-zinc-700 rounded-lg shadow-inner flex flex-col items-center">
                                <h2 className="text-2xl font-bold mb-6">{translations.settingsTab[language]}</h2>
                                <div className="space-y-4 w-full max-w-md">
                                    <div className="flex items-center justify-between bg-zinc-600 p-4 rounded-md">
                                        <label htmlFor="language-select" className="text-lg text-gray-200">Select Language:</label>
                                        <select
                                            id="language-select"
                                            value={language}
                                            onChange={(e) => setLanguage(e.target.value)}
                                            className="bg-zinc-800 text-white p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        >
                                            <option value="en">English</option>
                                            <option value="ko">한국어</option>
                                            <option value="es">Español</option>
                                        </select>
                                    </div>
                                    <div className="bg-zinc-600 p-4 rounded-md">
                                        <h3 className="text-lg font-semibold text-gray-200 mb-2">Web Serial Connection</h3>
                                        <p className="text-gray-300 text-sm mb-4">
                                            Connect to your Trkey micropad via USB serial for direct firmware upload.
                                            Requires a Chromium-based browser (e.g., Chrome, Edge).
                                        </p>
                                        <div className="flex space-x-2">
                                            <button
                                                onClick={connectSerial}
                                                className="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition duration-200 flex-1 disabled:opacity-50"
                                                disabled={!!port}
                                            >
                                                {port ? "Connected" : "Connect Device"}
                                            </button>
                                            <button
                                                onClick={disconnectSerial}
                                                className="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition duration-200 flex-1 disabled:opacity-50"
                                                disabled={!port}
                                            >
                                                Disconnect Device
                                            </button>
                                        </div>
                                        {port && (
                                            <button
                                                onClick={uploadKeymapViaSerial}
                                                className="mt-4 w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-200"
                                            >
                                                Upload Keymap via Serial
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'mapUpload' && (
                            <MapUploadTab language={language} translations={translations} onShowNotification={handleShowNotification} />
                        )}

                        {activeTab === 'keyTester' && (
                            <KeyTester />
                        )}
                    </main>

                    <footer className="w-full max-w-5xl text-center text-gray-500 text-sm mt-6">
                        <p>{translations.version[language]} 1.0</p>
                        <p>{translations.builtBy[language]} <a href="https://github.com/your-name" target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:underline">Your Name</a></p>
                    </footer>

                    {/* Notification Component */}
                    {notification && (
                        <Notification
                            message={notification.message}
                            type={notification.type}
                            onClose={handleCloseNotification}
                        />
                    )}

                    {/* Macro Form Modal for adding/editing macros */}
                    <MacroFormModal
                        show={showMacroFormModal}
                        onClose={() => setShowMacroFormModal(false)}
                        onSave={handleSaveMacro}
                        macro={editingMacro} // Pass the macro object if editing
                        language={language} // Pass language to modal
                    />

                    {/* Confirmation Modal for deleting macros */}
                    <ConfirmationModal
                        show={showConfirmationModal}
                        onClose={() => setShowConfirmationModal(false)}
                        onConfirm={confirmDeleteMacro}
                        message={translations.deleteMacroConfirmation[language]}
                        language={language} // Pass language to modal
                    />

                    {/* Add Shortcut Modal for adding custom shortcuts */}
                    <AddShortcutModal
                        show={showAddShortcutModal}
                        onClose={() => setShowAddShortcutModal(false)}
                        onSave={handleSaveNewShortcut}
                        language={language} // Pass language to modal
                    />
                </div>
            );
        }

        // Render the React App component into the 'root' div
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
